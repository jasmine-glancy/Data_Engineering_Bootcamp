# <img src="../books.svg" alt="Stack of red books with a graduation cap on top, symbolizing education and achievement, set against a plain background" width="30" height="20" /> Applying Analytical Patterns

## <img src="../notes.svg" alt="Orange pencil lying diagonally on a white sheet of paper, representing note taking and documentation, with a clean and organized appearance" width="20" height="15" /> Exploring SQL, Scaling Projects and Aggregation Analysis Day 1 Lecture

| Concept                | Notes            |
|---------------------|------------------|
| **A Note To Start**  | - Not all pipelines are built differently <br> &emsp;• If you can identify higher-level patterns, you can figure out the best types of pipelines to implement <br>- ***Repeatable analyses are your best friend because they allow you to think at a higher level***<br> &emsp;• Instead of thinking about `GROUP BY` and `SELECT`, you can think a layer above this <br> &emsp;• Think of this as an "extension" of SQL |
| **Analytical Patterns**  | - Growth Accounting <br> &emsp;• i.e. how Facebook tracks inflows and outflows of active and inactive users<br> &emsp;• Or any other state change tracking <br> &emsp;• Closely related to cumulative table design concepts <br>- Survival Analysis Pattern <br> &emsp;• i.e. of all the users who are active today, how many are still around? <br>- State change tracking <br> &emsp;• Closely connected with SCDs <br> &emsp;• SCDs have records for every different value of a dimension <br> &emsp;• Instead of keeping all of the *values* of a dimension, state change logs every time the values *changed* |
| **Common Pattterns to Learn**  | - Aggregation-based patterns<br>- Cumulation-based patterns <br>- Window-based patterns <br>- Enrichment patterns do not take place in this realm because we already have all the columns we need |
| **Repeatable Analyses**  | - Reduce cognitive load of thinking about the SQL <br> &emsp;• Think bigger picture! <br> &emsp;• How can you apply higher-level patterns?<br>- Streamline your impact <br> &emsp;• xxx |
| **Aggregation-Based Patterns**  | - Most common patterns <br> &emsp;• `GROUP BY` used often<br> &emsp;• Counting things<br> &emsp;• Trend analysis <br> &emsp;• Root cause analysis<br> &emsp;&emsp;• Explaining the movement of metrics<br> &emsp;&emsp;• If you start seeing a shift in a metric, you can bring in other metrics to investigate<br> &emsp;• Percentile <br> &emsp;• Composition <br> &emsp;• Add charts showing the composition of something <br><br> &emsp;• **Gotchas**<br> &emsp;&emsp;• Think about the combinations that matter the most <br> &emsp;&emsp;• Be careful looking at many-combination, long-time fram analyses (> 90 days)<br> &emsp;&emsp;&emsp;• You don't want too many cuts in your data when you have a long timeframe because time is a dimension with high cardinality |
| **Cumulation-Based Patterns**  | Time is significantly different dimensions vs other ones <br>- `FULL OUTER JOIN` is your friend <br> &emsp;• You need to keep track of when there *isn't* data (no data IS data in cumulation-based patterns!) <br> &emsp;• Built on top of cumulative tables<br>- Common for the following patterns:  <br> &emsp;•  State transition tracking<br> &emsp;&emsp;• Shows the shift of state between yesterday and today <br> &emsp;• Retention (AKA J curves or survivor analysis)  |
| **Growth Accounting**  | - Special version of state transition tracking <br> &emsp;• New <br> &emsp;&emsp;• Didn't exist yesterday, active today<br> &emsp;• Retained <br> &emsp;&emsp;• Active yesterday, active today<br> &emsp;• Churned<br> &emsp;&emsp;• Active yesterday, inactive today <br> &emsp;• Resurrected <br> &emsp;&emsp;• Inactive yesterday, active today <br> &emsp;• Stale<br> &emsp;&emsp;• Inactive yesterday, inactive today<br> &emsp;• Deactivated also exists <br> &emsp;&emsp;• Inactive yesterday, deleted today <br> &emsp;&emsp;• Only sometimes there <br><br>![Growth Accounting](growthaccounting.png) <br> - Think of growth rate as new + resurrected minus churn<br>- Great for monitoring and machine learning models |
| **Survivor Analysis**  | - J-curves have 3 points<br> &emsp;• The curve <br> &emsp;&emsp;• Examples: Users who stay active, boot camp attendees who keep attending all the sessions, smokers who remain smoke-free after quitting <br> &emsp;• The state check <br> &emsp;&emsp;• Activity on the app, activity on Zoom, not smoking<br> &emsp;• The reference date <br> &emsp;&emsp;• Examples: sign up date, enrollment date, quit date |
| **Window-based Analyses**  | - Day over day / week over week / month over month / year over year <br> &emsp;• Examining the rate of change over a range of time <br>- Rolling sum/average <br> &emsp;• Decreases the volatility<br>- Rank <br> &emsp;• For more complex ranks <br>- Example of a window function<br> &emsp;• `FUNCTION() OVER (PARTITION BY keys ORDER BY sort ROWS BETWEEN n PRECEDING AND CURRENT ROW)`<br> &emsp;&emsp;• Usually sorted by date<br> &emsp;&emsp;• Partition by the dimensional cut is <br> &emsp;&emsp;• n = number of rolling days <br><br>**Gotchas**<br>- Be sure to use `PARTITION BY` or else it will cause OOM when the data is too large |

## <img src="../question-and-answer.svg" alt="Two speech bubbles, one with a large letter Q and the other with a large letter A, representing a question and answer exchange in a friendly and approachable style" width="35" height="28" /> Cues

- What is the purpose of using analytical patterns in data engineering?
- In the context of SQL and data analytics, what does aggregation-based analysis primarily utilize?
- How does cumulation-based analysis differ from aggregation-based analysis in terms of data handling?
- What is survivorship bias as explained in the lecture?
- What is an example of a common window-based analysis mentioned in the lecture?

---

## <img src="../summary.svg" alt="Rolled parchment scroll with visible lines, symbolizing a summary or conclusion, placed on a neutral background" width="30" height="18" /> Summary

The lecture emphasizes that recognizing higher-level analytical patterns allows data engineers to implement effective pipelines quickly. This streamlines the analysis process and reduces cognitive load.

Aggregation-based analysis relies on `GROUP BY` to organize data into subgroups and uses functions like `SUM`, `COUNT`, and `AVERAGE` to perform calculations on these groups. Cumulation-based patterns are concerned with the transitions between states over time. They handle missing data as meaning ful information, unlike traditional aggregation patterns that may disregard missing data.

Survivorship bias occurs when only the successful outcomes or entities that survived a process are considered, potentially leading to incorrect conclusions by ignoring those that did not survive. The lecture covers window-based analysis as involving operations like day-over-day or month-over-month analyses utilizing window functions to calculate derivatives or rolling averages.
